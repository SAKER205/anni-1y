<!DOCTYPE html>
<html lang="vi">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kỷ Niệm 1 Năm ❤️</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

<style>

:root { 
--heart-color:#FF5CA4; 
--bg-soft:#ffeef2; 
}

body, html {
margin:0;
padding:0;
height:100%;
overflow:hidden;
background:#000;
font-family:'Quicksand',sans-serif;
}

/* ================= MÀN 1 ================= */

#screen-1 {
position: fixed;
width: 100%;
height: 100%;
display: flex;
justify-content: center;
align-items: center;
z-index: 100;
transition: opacity 1.5s;
background: #000;
}

#pinkboard {
position: relative;
width: 100%;
height: 100%;
}

.name-center {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -55%);
color: var(--heart-color);
font-size: 2.5rem;
font-family: 'Dancing Script', cursive;
text-shadow: 0 0 15px var(--heart-color);
z-index: 101;
pointer-events: none;
animation: textPulse 1.3s infinite;
}

#btn-start {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
padding: 20px 40px;
border-radius: 50px;
border: none;
background: var(--heart-color);
color: white;
font-weight: bold;
cursor: pointer;
display: none;
z-index: 150;
box-shadow: 0 0 30px var(--heart-color);
font-size: 1.1rem;
}

/* ================= MÀN 2 ================= */

#screen-2 {
background: var(--bg-soft) url('https://www.transparenttextures.com/patterns/heart.png');
position: fixed;
width: 100%;
height: 100%;
display: none;
justify-content: center;
align-items: center;
z-index: 90;
opacity: 0;
transition: opacity 2s;
flex-direction: column;
}

.chibi-img {
width: 220px;
animation: float 3s infinite ease-in-out;
border-radius: 20px;
}

.dialog-box {
background: white;
padding: 25px;
border-radius: 25px;
margin-top: 25px;
color: #d63384;
font-weight: bold;
text-align: center;
max-width: 85%;
border: 2px solid #ffcad4;
box-shadow: 0 10px 20px rgba(0,0,0,0.05);
}

/* ================= MÀN 3 ================= */

#screen-3 {
background: var(--bg-soft) url('https://www.transparenttextures.com/patterns/heart.png');
position: fixed;
width: 100%;
height: 100%;
display: none;
z-index: 80;
overflow: hidden;
}

.memory-item {
position: absolute;
width: 220px;
height: 220px;
object-fit: cover;
border-radius: 20px;
border: none !important;
box-shadow: 0 8px 25px rgba(214, 51, 132, 0.2);
opacity: 0;
transition: opacity 1.5s ease-in-out, transform 2s ease-in-out;
z-index: 81;
}

/* ================= THƯ ================= */

#screen-letter {
position: fixed;
width: 100%;
height: 100%;
display: none;
justify-content: center;
align-items: center;
z-index: 200;
background: rgba(0,0,0,0.8);
backdrop-filter: blur(10px);
transition: opacity 1.5s;
}

.scroll-container {
width: 95%;
max-width: 500px;
background: #fdf5e6;
padding: 30px;
border-radius: 5px;
position: relative;
box-shadow: inset 0 0 50px rgba(0,0,0,0.1), 0 20px 50px rgba(0,0,0,0.5);
max-height: 0;
overflow: hidden;
transition: max-height 2.5s ease-in-out;
border-left: 12px solid #d4a76a;
border-right: 12px solid #d4a76a;
}

.scroll-container.open {
width:95%;
max-height: 75vh;
overflow-y: auto;
}

.letter-content {
font-family: 'Dancing Script', cursive;
font-size: 1.4rem;
color: #5d4037;
line-height: 1.8;
text-align: center;
white-space: pre-wrap;
padding-bottom: 20px;
}

.letter-content span {
opacity: 0;
transition: opacity 0.02s;
}

.letter-content span.visible {
opacity: 1;
}

/* ================= FINAL ================= */

#screen-final {
position: fixed;
width: 100%;
height: 100%;
display: none;
flex-direction: column;
justify-content: center;
align-items: center;
z-index: 300;
background: #000;
opacity: 0;
transition: opacity 2.5s;
overflow: hidden;
}

.final-bg {
position: absolute;
width: 100%;
height: 100%;
background: url('img/final_bg.jpg') center/cover no-repeat;
filter: blur(4px) brightness(0.7);
transform: scale(1.1);
}

.final-content {
position: relative;
z-index: 301;
text-align: center;
padding: 20px;
}

.final-text {
font-family: 'Dancing Script', cursive;
font-size: 2.2rem;
color: #fff;
text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
line-height: 1.4;
}

.floating-heart {
position: absolute;
color: #ff5ca4;
pointer-events: none;
animation: flyUp 4s linear forwards;
opacity: 0.8;
}

/* ================= ANIMATION ================= */

@keyframes flyUp {
to { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
}

@keyframes textPulse {
0%, 100% { transform: translate(-50%, -55%) scale(1); }
50% { transform: translate(-50%, -55%) scale(1.1); }
}

@keyframes float {
0%, 100% { transform: translateY(0); }
50% { transform: translateY(-20px); }
}

/* ================= RESPONSIVE ================= */

/* ================= FIX TRÀN MOBILE ================= */
@media (max-width:480px){

/* khóa tràn ngang toàn trang */
html, body{
overflow-x:hidden;
}

/* tim nhỏ hơn */
.name-center{
font-size:1.8rem;
}

/* nút nhỏ hơn */
#btn-start{
font-size:0.95rem;
padding:12px 24px;
}

/* chibi nhỏ */
.chibi-img{
width:160px;
}

/* ảnh kỷ niệm nhỏ lại */
.memory-item{
width:140px;
height:140px;
}

/* thư */
.letter-content{
font-size:1.15rem;
}

/* chữ cuối */
.final-text{
font-size:1.6rem;
}

}


</style>
</head>

<body>

<audio id="bg-music" loop>
<source src="mot-doi.mp3" type="audio/mpeg">
</audio>

<div id="screen-1">
<canvas id="pinkboard"></canvas>
<div class="name-center">dvan ❤️ mhang</div>
</div>

<button id="btn-start"> Công chúa ơi! Giúp anh ấn vào đây nha ❤️</button>

<div id="screen-2">
<img src="chibidvan.jpg" class="chibi-img">
<div class="dialog-box" id="talk">Chào công chúa của anh,</div>
</div>

<div id="screen-3"></div>

<div id="screen-letter">
<div class="scroll-container" id="scroll">
<div class="letter-content" id="letter-text"></div>
</div>
</div>

<div id="screen-final">
<div class="final-bg"></div>
<div class="final-content">
<div class="final-text">
Cảm ơn mhang đã đọc những lời nhắn nhủ của anh.<br>
Anh yêu em thật nhiều!<br>
❤️ Happy Anniversary ❤️
</div>
</div>
</div>

<!-- ================================================= -->
<!-- ==================== JS GỐC ==================== -->
<!-- ================================================= -->

<script>

/* --- TRÁI TIM CHỦ ĐẠO --- */

var settings = { particles: { length: 2000, duration: 4, velocity: 100, effect: -1.3, size: 13 } };

(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());

var Point=(function(){function Point(x,y){this.x=x||0;this.y=y||0}Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.length=function(l){if(l===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);this.normalize();this.x*=l;this.y*=l;return this};Point.prototype.normalize=function(){var l=this.length();this.x/=l;this.y/=l;return this};return Point})();

var Particle=(function(){function Particle(){this.position=new Point();this.velocity=new Point();this.acceleration=new Point();this.age=0}
Particle.prototype.initialize=function(x,y,dx,dy){this.position.x=x;this.position.y=y;this.velocity.x=dx;this.velocity.y=dy;this.acceleration.x=dx*settings.particles.effect;this.acceleration.y=dy*settings.particles.effect;this.age=0};
Particle.prototype.update=function(dt){this.position.x+=this.velocity.x*dt;this.position.y+=this.velocity.y*dt;this.velocity.x+=this.acceleration.x*dt;this.velocity.y+=this.acceleration.y*dt;this.age+=dt};
Particle.prototype.draw=function(ctx,img){function ease(t){return(--t)*t*t+1}var size=img.width*ease(this.age/settings.particles.duration);ctx.globalAlpha=1-this.age/settings.particles.duration;ctx.drawImage(img,this.position.x-size/2,this.position.y-size/2,size,size)};
return Particle})();

var ParticlePool=(function(){var particles,firstActive=0,firstFree=0,duration=settings.particles.duration;
function ParticlePool(l){particles=new Array(l);for(var i=0;i<particles.length;i++)particles[i]=new Particle()}
ParticlePool.prototype.add=function(x,y,dx,dy){particles[firstFree].initialize(x,y,dx,dy);firstFree++;if(firstFree==particles.length)firstFree=0;if(firstActive==firstFree)firstActive++;if(firstActive==particles.length)firstActive=0};
ParticlePool.prototype.update=function(dt){var i;if(firstActive<firstFree){for(i=firstActive;i<firstFree;i++)particles[i].update(dt)}if(firstFree<firstActive){for(i=firstActive;i<particles.length;i++)particles[i].update(dt);for(i=0;i<firstFree;i++)particles[i].update(dt)}while(particles[firstActive].age>=duration&&firstActive!=firstFree){firstActive++;if(firstActive==particles.length)firstActive=0}};
ParticlePool.prototype.draw=function(ctx,img){var i;if(firstActive<firstFree){for(i=firstActive;i<firstFree;i++)particles[i].draw(ctx,img)}if(firstFree<firstActive){for(i=firstActive;i<particles.length;i++)particles[i].draw(ctx,img);for(i=0;i<firstFree;i++)particles[i].draw(ctx,img)}};
return ParticlePool})();

(function(canvas){
var context=canvas.getContext('2d'),
particles=new ParticlePool(settings.particles.length),
particleRate=settings.particles.length/settings.particles.duration,
time;

function pointOnHeart(t){
return new Point(
160*Math.pow(Math.sin(t),3),
130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
);
}

var image=(function(){
var c=document.createElement('canvas'),
ctx=c.getContext('2d');
c.width=settings.particles.size;
c.height=settings.particles.size;
function to(t){
var p=pointOnHeart(t);
p.x=settings.particles.size/2+p.x*settings.particles.size/350;
p.y=settings.particles.size/2-p.y*settings.particles.size/350;
return p;
}
ctx.beginPath();
var t=-Math.PI,p=to(t);
ctx.moveTo(p.x,p.y);
while(t<Math.PI){t+=0.01;p=to(t);ctx.lineTo(p.x,p.y);}
ctx.closePath();
ctx.fillStyle='#FF5CA4';
ctx.fill();
var img=new Image();
img.src=c.toDataURL();
return img;
})();

function render(){
requestAnimationFrame(render);
var newTime=new Date().getTime()/1000;
var delta=newTime-(time||newTime);
time=newTime;
context.clearRect(0,0,canvas.width,canvas.height);
var amount=particleRate*delta;
for(var i=0;i<amount;i++){
var pos=pointOnHeart(Math.PI-2*Math.PI*Math.random());
var dir=pos.clone().length(settings.particles.velocity);
particles.add(canvas.width/2+pos.x,canvas.height/2-pos.y,dir.x,-dir.y);
}
particles.update(delta);
particles.draw(context,image);
}

function resize(){
canvas.width=canvas.clientWidth;
canvas.height=canvas.clientHeight;
}
window.onresize=resize;
setTimeout(resize,10);
render();
})(document.getElementById("pinkboard"));

/* ====== LOGIC ====== */

let photoPool = Array.from({length:50},(_,i)=>`img/${i+1}.jpg`);

const loveLetter = `Gửi mhang của anh

Vậy là chúng ta đã bên nhau được một năm rồi đấy. Anh yêu em nhiều lắm. Anh hạnh phúc khi được cùng em đồng hành, cùng em chiêm nghiệm thế giới xung quanh. Có em đến bên đời, cuộc sống của anh có thêm nhiều màu sắc hơn, có thêm nhiều ý nghĩa hơn. Đặc biệt, em đã khiến anh cảm thấy được yêu là như thế nào.

Anh không phải là người sâu sắc trong mọi hành động, đôi khi làm em phát bực, anh xin lỗi em vì những lần khó ưa của anh.

Anh ước mong mình sẽ bên nhau thật lâu, thật lâu, vì anh yêu em, anh muốn được hạnh phúc cùng với em.

Nếu mình sai thì cùng sửa, nếu có sóng gió thì cùng nhau vượt qua nhé em.

Đoạn đường phía trước còn dài, anh sẽ bảo vệ và che chở em, cục cưng của anh ạ!

Anh yêu em nhiều lắm ❤️

Người yêu em,
Trần Đức Văn`;

const music=document.getElementById("bg-music");
const btn=document.getElementById("btn-start");

window.onload=()=>{setTimeout(()=>btn.style.display="block",4000);}

btn.onclick=()=>{
music.play();
btn.style.display="none";
document.getElementById("screen-1").style.opacity="0";
setTimeout(()=>{
document.getElementById("screen-1").style.display="none";
startIntro();
},1000);
}

function startIntro(){
const s2=document.getElementById("screen-2");
s2.style.display="flex";
setTimeout(()=>s2.style.opacity="1",100);

const scripts=[
"Mới ngày nào mình còn chập chững đến bên nhau",
"Vậy mà đã 1 năm trôi qua rồi!",
"Anh muốn gửi đến em hành trình của chúng ta một năm vừa rồi",
"Đây là những kỉ niệm mà anh luôn giữ bên mình. Anh yêu em <3"
];

let i=0;
let timer=setInterval(()=>{
if(i<scripts.length)
document.getElementById("talk").innerText=scripts[i++];
else{
clearInterval(timer);
startMemories();
}
},2500);
}

function startMemories(){
document.getElementById("screen-2").style.opacity="0";
setTimeout(()=>{
document.getElementById("screen-2").style.display="none";
document.getElementById("screen-3").style.display="block";

let flow=setInterval(()=>{
if(photoPool.length>0){
let r=Math.floor(Math.random()*photoPool.length);
let img=photoPool.splice(r,1)[0];
createMemory(img);
}else{
clearInterval(flow);
setTimeout(showScrollLetter,4000);
}
},1100);

},1000);
}

function createMemory(src){
const item=document.createElement("img");
item.className="memory-item";
item.src=src;
item.style.left=Math.random()*(window.innerWidth-240)+10+"px";
item.style.top=Math.random()*(window.innerHeight-240)+10+"px";
document.getElementById("screen-3").appendChild(item);

setTimeout(()=>{
item.style.opacity="1";
item.style.transform=`rotate(${Math.random()*26-13}deg)`;
},100);

setTimeout(()=>{
item.style.opacity="0";
setTimeout(()=>item.remove(),1500);
},4000);
}

function showScrollLetter(){
document.getElementById("screen-3").style.opacity="0";
setTimeout(()=>{
document.getElementById("screen-3").style.display="none";
const scr=document.getElementById("screen-letter");
const scroll=document.getElementById("scroll");
const txt=document.getElementById("letter-text");

scr.style.display="flex";
scroll.scrollTop=0;

setTimeout(()=>{
scroll.classList.add("open");
typeLetter(loveLetter,txt);
},500);

},1000);
}

function typeLetter(text,el){
const chars=text.split("");
el.innerHTML="";
const speed=45;
const sc=document.getElementById("scroll");

chars.forEach((c,i)=>{
const span=document.createElement("span");
span.textContent=c;
el.appendChild(span);
setTimeout(()=>{
span.classList.add("visible");
sc.scrollTo({top:span.offsetTop-50,behavior:"smooth"});
},i*speed);
});

setTimeout(showFinal,chars.length*speed+5000);
}

function showFinal(){
const scroll=document.getElementById("scroll");
scroll.classList.remove("open");

setTimeout(()=>{
document.getElementById("screen-letter").style.opacity="0";

setTimeout(()=>{
document.getElementById("screen-letter").style.display="none";
const final=document.getElementById("screen-final");
final.style.display="flex";
setTimeout(()=>{
final.style.opacity="1";
spawnHearts();
},100);
},1500);

},1000);
}

function spawnHearts(){
setInterval(()=>{
const h=document.createElement("div");
h.className="floating-heart";
h.innerHTML="❤️";
h.style.left=Math.random()*100+"vw";
h.style.fontSize=Math.random()*20+20+"px";
h.style.bottom="-50px";
document.getElementById("screen-final").appendChild(h);
setTimeout(()=>h.remove(),4000);
},300);
}

</script>

</body>
</html>
